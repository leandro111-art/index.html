
<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Banana Buddy AI</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; background: #f2f8f2; color: #333; }
  header { background: #4caf50; color: white; padding: 15px; text-align: center; font-size: 1.5em; }
  .container { padding: 20px; max-width: 900px; margin: auto; }
  h2 { color: #2b5d2b; }
  .panel { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
  label { display: block; margin-top: 10px; font-weight: bold; }
  input, button { margin-top: 5px; padding: 8px; width: 100%; border: 1px solid #ccc; border-radius: 5px; }
  button { background: #4caf50; color: white; border: none; cursor: pointer; }
  button:hover { background: #45a049; }
  table { border-collapse: collapse; width: 100%; margin-top: 10px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background: #f0f0f0; }
  button.small { padding: 3px 6px; font-size: 12px; background: #f44336; }
  canvas { background: #fff; border: 1px solid #ccc; margin-top: 15px; width: 100%; }
  .alert { padding: 10px; margin-bottom: 15px; border-radius: 5px; color: white; }
  .alert.good { background: #4caf50; }
  .alert.warn { background: #ff9800; }
  .alert.bad { background: #f44336; }
</style>
</head>
<body>
<header>üçå Banana Buddy AI</header>
<div class="container">

<div id="alerts"></div>

<div class="panel">
  <h2>Clima e Previs√µes</h2>
  <p id="weatherNow">A obter dados meteorol√≥gicos de Ansi√£es...</p>
  <ul id="forecastList"></ul>
  <p id="growthPrediction"></p>
</div>

<div class="panel">
  <h2>Registo de Crescimento</h2>
  <label>Data: <input type="date" id="logDate"></label>
  <label>Altura (cm): <input type="number" id="logHeight"></label>
  <label>N√∫mero de folhas: <input type="number" id="logLeaves"></label>
  <label>Notas: <input type="text" id="logNotes"></label>
  <button onclick="addLog()">Adicionar Registo</button>
  <label><input type="checkbox" id="showHeight" checked onchange="renderChart()"> Mostrar Altura</label>
  <label><input type="checkbox" id="showLeaves" checked onchange="renderChart()"> Mostrar Folhas</label>
  <table id="growthTable">
    <thead>
      <tr><th>Data</th><th>Altura (cm)</th><th>Crescimento (cm)</th><th>Folhas</th><th>Notas</th><th>A√ß√µes</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <canvas id="growthChart" height="300"></canvas>
</div>

</div>
<script>
let growthLogs = JSON.parse(localStorage.getItem('growthLogs') || '[]');

function renderLogs(){
  const tbody = document.querySelector('#growthTable tbody');
  tbody.innerHTML = '';
  growthLogs.sort((a,b) => new Date(a.date) - new Date(b.date));
  for(let i=growthLogs.length-1; i>=0; i--){
    const log = growthLogs[i];
    let growthChange = '';
    if(i < growthLogs.length - 1){
      const prevHeight = parseFloat(growthLogs[i+1].height) || 0;
      const currHeight = parseFloat(log.height) || 0;
      growthChange = (currHeight - prevHeight).toFixed(1);
      if(growthChange >= 0) growthChange = '+' + growthChange;
    }
    const row = document.createElement('tr');
    row.innerHTML = `<td>${log.date}</td><td>${log.height}</td><td>${growthChange}</td><td>${log.leaves}</td><td>${log.notes}</td><td><button class='small' onclick='deleteLog(${i})'>Eliminar</button></td>`;
    tbody.appendChild(row);
  }
  renderChart();
}

function addLog(){
  const date = document.getElementById('logDate').value;
  const height = document.getElementById('logHeight').value;
  const leaves = document.getElementById('logLeaves').value;
  const notes = document.getElementById('logNotes').value;
  if(!date) return alert('Data obrigat√≥ria');
  growthLogs.push({date, height, leaves, notes});
  localStorage.setItem('growthLogs', JSON.stringify(growthLogs));
  renderLogs();
}

function deleteLog(index){
  growthLogs.splice(index, 1);
  localStorage.setItem('growthLogs', JSON.stringify(growthLogs));
  renderLogs();
}

function renderChart(){
  const canvas = document.getElementById('growthChart');
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const showHeight = document.getElementById('showHeight').checked;
  const showLeaves = document.getElementById('showLeaves').checked;

  const sortedLogs = [...growthLogs].sort((a,b) => new Date(a.date) - new Date(b.date));
  if(sortedLogs.length < 2) return;

  const dates = sortedLogs.map(l => new Date(l.date));
  const heights = sortedLogs.map(l => parseFloat(l.height) || 0);
  const leaves = sortedLogs.map(l => parseInt(l.leaves) || 0);

  const minDate = dates[0];
  const maxDate = dates[dates.length-1];
  const minHeight = Math.min(...heights);
  const maxHeight = Math.max(...heights);
  const minLeaves = Math.min(...leaves);
  const maxLeaves = Math.max(...leaves);

  function xScale(date){ return ((date - minDate) / (maxDate - minDate)) * (canvas.width - 80) + 50; }
  function yScaleHeight(value){ return canvas.height - ((value - minHeight) / (maxHeight - minHeight)) * (canvas.height - 60) - 30; }
  function yScaleLeaves(value){ return canvas.height - ((value - minLeaves) / (maxLeaves - minLeaves)) * (canvas.height - 60) - 30; }

  ctx.strokeStyle = '#ccc';
  ctx.beginPath();
  for(let i=0;i<=5;i++){
    const y = 30 + i*((canvas.height-60)/5);
    ctx.moveTo(50,y);
    ctx.lineTo(canvas.width-30,y);
  }
  ctx.stroke();

  ctx.strokeStyle = '#000';
  ctx.beginPath();
  ctx.moveTo(50, 30);
  ctx.lineTo(50, canvas.height - 30);
  ctx.lineTo(canvas.width - 30, canvas.height - 30);
  ctx.stroke();

  ctx.fillStyle = '#000';
  ctx.textAlign = 'center';
  const dateCount = dates.length;
  const step = Math.ceil(dateCount / 6);
  for(let i=0;i<dateCount;i+=step){
    const x = xScale(dates[i]);
    ctx.fillText(dates[i].toLocaleDateString('pt-PT'), x, canvas.height - 10);
  }

  ctx.textAlign = 'right';
  for(let i=0;i<=5;i++){
    const val = minHeight + (i*(maxHeight - minHeight)/5);
    ctx.fillText(val.toFixed(0)+'cm', 45, yScaleHeight(val)+4);
  }

  ctx.textAlign = 'left';
  for(let i=0;i<=5;i++){
    const val = minLeaves + (i*(maxLeaves - minLeaves)/5);
    ctx.fillText(val+' folhas', canvas.width - 25, yScaleLeaves(val)+4);
  }

  if(showHeight){
    ctx.strokeStyle = '#4caf50';
    ctx.beginPath();
    heights.forEach((h, i) => {
      const x = xScale(dates[i]);
      const y = yScaleHeight(h);
      if(i === 0) ctx.moveTo(x, y);
      else ctx.lineTo(x, y);
    });
    ctx.stroke();
  }

  if(showLeaves){
    ctx.strokeStyle = '#2196f3';
    ctx.beginPath();
    leaves.forEach((l, i) => {
      const x = xScale(dates[i]);
      const y = yScaleLeaves(l);
      if(i === 0) ctx.moveTo(x, y);
      else ctx.lineTo(x, y);
    });
    ctx.stroke();
  }
}

// Fetch weather for Ansi√£es
async function fetchWeather(){
  try {
    const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=41.2667&longitude=-7.9667&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,relative_humidity_2m_max&current_weather=true&timezone=auto');
    const data = await res.json();
    document.getElementById('weatherNow').innerText = `Agora: ${data.current_weather.temperature}¬∞C, vento ${data.current_weather.windspeed} km/h`;
    const list = document.getElementById('forecastList');
    list.innerHTML = '';
    for(let i=0; i<data.daily.time.length; i++){
      const li = document.createElement('li');
      li.textContent = `${data.daily.time[i]} - M√°x ${data.daily.temperature_2m_max[i]}¬∞C, Min ${data.daily.temperature_2m_min[i]}¬∞C, Chuva: ${data.daily.precipitation_sum[i]}mm`;
      list.appendChild(li);
    }
    givePrediction(data);
  } catch (e){
    document.getElementById('weatherNow').innerText = 'Erro ao obter clima.';
  }
}

function givePrediction(data){
  let alertBox = document.getElementById('alerts');
  alertBox.innerHTML = '';
  let avgTemp = data.daily.temperature_2m_max[0];
  let rain = data.daily.precipitation_sum[0];
  let humidity = data.daily.relative_humidity_2m_max[0];

  let prediction = '';
  if(avgTemp >= 20 && avgTemp <= 30 && rain > 2 && humidity > 60){
    prediction = 'Condi√ß√µes ideais para crescimento r√°pido.';
    alertBox.innerHTML = '<div class="alert good">üå± Crescimento √≥timo esperado!</div>';
  } else if(avgTemp < 15){
    prediction = 'Crescimento lento devido a temperaturas baixas.';
    alertBox.innerHTML = '<div class="alert bad">‚ö†Ô∏è Frio excessivo, crescimento pode parar.</div>';
  } else if(rain < 1){
    prediction = 'Pouca chuva, rega necess√°ria.';
    alertBox.innerHTML = '<div class="alert warn">üíß Pouca chuva, considere regar.</div>';
  } else {
    prediction = 'Crescimento normal esperado.';
  }
  document.getElementById('growthPrediction').innerText = prediction;
}

window.onload = function(){
  renderLogs();
  fetchWeather();
}
</script>
</body>
</html>
